<script id="data-script" type="application/json">
  <%- JSON.stringify(files) %>
</script>

<%- include('partials/header') -%>

<%- include('partials/spinner') -%>

<div class="layout">
  <aside class="layout-sidebar">
    <%- include('partials/tree', { baseUrl: `/public/${sharedFolderId}`}) -%>
  </aside>
  <main class="layout-main">

      <%- include('partials/breadcrumb', { baseUrl: `/public/${sharedFolderId}`}) -%>

      <div class='grid-container'>
        <div class="grid-header">
          <a href="/public/<%= sharedFolderId %>/<%= folderId %><%= helpers.generateSortLink(sortQuery, 'name') %>">
            <div class="grid-header-col">
              <div class="grid-col">Name</div>
              <% if (sortQuery.name) { %>
                <sl-icon-button name="<%= sortQuery.name === 'desc' ? 'caret-down' : 'caret-up' %>" label="Sort by name"></sl-icon-button>
              <% } %>
            </div>
          </a>
          <a href="<%= helpers.generateSortLink(sortQuery, 'size') %>">
            <div class="grid-header-col">
              <div class="grid-col">Size</div>
              <% if (sortQuery.size) { %>
                <sl-icon-button name="<%= sortQuery.size === 'desc' ? 'caret-down' : 'caret-up' %>" label="Sort by size"></sl-icon-button>
              <% } %>
            </div>
          </a>
          <a href="<%= helpers.generateSortLink(sortQuery, 'createdAt') %>">
            <div class="grid-header-col">
              <div class="grid-col">Created</div>
              <% if (sortQuery.createdAt) { %>
                <sl-icon-button name="<%= sortQuery.createdAt === 'desc' ? 'caret-down' : 'caret-up' %>" label="Sort by date created"></sl-icon-button>
              <% } %>
            </div>
          </a>
        </div>
        <sl-drawer label="File Information" class="drawer-overview">
          <div class="drawer-content"></div>
          <div class="btn-group" slot="footer">
            <sl-button class="drawer-close-btn">Close</sl-button>
            <sl-button type="submit" variant="primary" class="drawer-download-btn">Download</sl-button>
          </div>
        </sl-drawer>
        <% for (var i = 0; i < files.length; i++) {
          let icon = files[i].type === 'FILE' ? 'file-earmark' : 'folder'; %>
          <button 
            <% if (files[i].type === 'FILE') { %>
              data-index="<%= i %>" 
            <% } else { %>
              onclick="window.location.href='/public/<%= `${sharedFolderId}/${files[i].id}` %>'" 
            <% } %>
            class="btn grid-row">
            <div class="grid-col col-name">
              <sl-icon class="col-name-icon" name="<%= icon %>"></sl-icon>
              <small><%= files[i].name %></small>
            </div>
            <small class="grid-col">
              <% if (files[i].size) { %>
                <sl-format-bytes value="<%= files[i].size %>"></sl-format-bytes>
              <% } else { %>
                --
              <% } %>
            </small>
            <small class="grid-col"><%= helpers.formatDate(files[i].createdAt) %></small>
          </button>
        <% } %>
      </div>
  </main>
</div>

<script type="module" src="/scripts/publicFolder.js"></script>

<%- include('partials/footer') -%>
